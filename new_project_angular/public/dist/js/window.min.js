angular.module("app",["ui.bootstrap","ngRoute"]).config(["$routeProvider","$locationProvider",function(n,e){n.when("/cabinet",{templateUrl:"cabinet/links_view",controller:"MainController"}).when("/cabinet/all",{templateUrl:"/cabinet/all_links_view",controller:"MainController"}).when("/edit_profile",{templateUrl:"/cabinet/edit_profile",controller:"MainController"}),e.html5Mode(!0)}]),angular.module("app").controller("accordionCtrl",function(n,e){n.status={isFirstOpen:!0,isFirstDisabled:!1},e.getUser.async().then(function(e){n.users=e}),e.getLinks.async().then(function(e){n.links=e})}),angular.module("app").factory("accordionService",function(n){var e={async:function(){var e=n.get("/get_user").then(function(n){return n.data});return e}},t={async:function(){var e=n.get("/cabinet/get_links").then(function(n){return n.data});return e}};return{getUser:e,getLinks:t}}),angular.module("app").controller("logIn",function(n,e){n.open=function(t){e.open({templateUrl:"logIn.html",controller:"ModalInstanceCtrl",size:t,resolve:{items:function(){return n.items}}})}}).controller("registration",function(n,e){n.open2=function(t){e.open({templateUrl:"registration.html",controller:"ModalInstanceCtrl",size:t,resolve:{items:function(){return n.items}}})}}).controller("ModalInstanceCtrl",function(){}),angular.module("app").controller("MainController",function(n,e,t){function r(e){n.setPage=function(e){n.currentPage=e},n.pageChanged=function(){var t=(n.currentPage-1)*n.numPerPage,r=t+n.numPerPage;n.links=e.slice(t,r)};var t=(n.currentPage-1)*n.numPerPage,r=t+n.numPerPage;n.links=e.slice(t,r)}var i=1,a=10,o="",l="all",c="",s="";n.currentPage=i,n.numPerPage=a,n.linksstate=o,n.status=l,n.user=c,n.links=s,t.getLinks.async().then(function(e){n.totalItems=e.length,o=e,r(e)}),t.editProfile.async().then(function(n){c=n}),n.addlink=function(){var i={params:{longUrl:n.link,apiKey:"R_a504087bf6004b44a4c9026f77e65aa5",login:"reexar"}};t.addLinks.async(i).then(function(t){n.shortLink=t.data.url,e.post("/cabinet/links/",{params:{longUrl:n.link,shortUrl:t.data.url}}).success(function(e){n.totalItems=e.length,o=e,r(e)}).error(function(n){console.error(arguments),alert("Неудалось сохранить ссылки в БД"),$("html").html(n.responseText)})})},n.checked=function(e){t.checkedLinks.async(e).then(function(e){o=e,s=e,"checked"==l&&(s=$.grep(s,function(n){return n.checked?n:void 0}),n.totalItems=s.length),"unchecked"==l&&(s=$.grep(s,function(n){return n.checked?void 0:n}),n.totalItems=s.length),r(s)})},n.deleteLinks=function(){n.links=$.grep(n.links,function(e){if(!e.checked)return n.links;var i={params:{id:e._id}};t.deleteLink.async(i).then(function(e){n.totalItems=e.length,n.linksstate=e,n.links=e,"checked"==n.status&&(n.links=$.grep(n.links,function(n){return n.checked?n:void 0}),n.totalItems=n.links.length),"unchecked"==n.status&&(n.links=$.grep(n.links,function(n){return n.checked?void 0:n}),n.totalItems=n.links.length),r(n.links)})})},n.deleteAllLinks=function(){n.links=$.grep(n.links,function(e){var i={params:{id:e._id}};t.deleteLink.async(i).then(function(e){n.totalItems=e.length,n.linksstate=e,n.links=e,"checked"==n.status&&(n.links=$.grep(n.links,function(n){return n.checked?n:void 0}),n.totalItems=n.links.length),"unchecked"==n.status&&(n.links=$.grep(n.links,function(n){return n.checked?void 0:n}),n.totalItems=n.links.length),r(n.links)})})},n.showall=function(){s=o,n.totalItems=s.length,l="all",r(s)},n.showchecked=function(){s=o,l="checked",s=$.grep(s,function(n){return n.checked?n:void 0}),n.totalItems=s.length,r(s)},n.showunchecked=function(){s=o,l="unchecked",s=$.grep(s,function(n){return n.checked?void 0:n}),n.totalItems=s.length,r(s)},n.update_user=function(e){var r={params:{id:e,username:n.user.username,hender:n.user.gender,password:n.user.password}};t.updateProfile.async(r).then(function(){})}}).controller("MenuCtrl",function(n,e,t){n.logout=function(){t.location.href="/logout"}}),angular.module("app").factory("LinkService",function(n){var e={async:function(){var e=n.get("/cabinet/links").then(function(n){return n.data});return e}},t={async:function(e){var t=n.get("http://api.bit.ly/v3/shorten",e).then(function(n){return n.data});return t}},r={async:function(){var e=n.get("/cabinet/edit_user").then(function(n){return n.data});return e}},i={async:function(e){var t=n.put("/cabinet/edit_user",e).then(function(n){return n.data});return t}},a={async:function(e){var t=n.put("/cabinet/links",{params:{id:e}}).then(function(n){return n.data});return t}},o={async:function(e){var t=n["delete"]("/cabinet/links/",e).then(function(n){return n.data});return t}};return{getLinks:e,addLinks:t,editProfile:r,updateProfile:i,checkedLinks:a,deleteLink:o}});